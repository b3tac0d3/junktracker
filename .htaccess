RewriteEngine On

RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP:X-Forwarded-Proto} !https [NC]
RewriteCond %{HTTP_HOST} !^(localhost|127\.0\.0\.1)(:[0-9]+)?$ [NC]
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L,NE]

<IfModule mod_headers.c>
    Header always set X-Robots-Tag "noindex, nofollow, noarchive, nosnippet, noimageindex"
</IfModule>

# Block access to application internals and dotfiles
RewriteRule ^(app|core|config|routes|layout|vendor|storage)/ - [F,L]
RewriteRule ^\. - [F,L]

# Serve existing files and directories directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Map /assets/* to /public/assets/*
RewriteRule ^assets/(.*)$ public/assets/$1 [L]

# Route all other requests through the front controller
RewriteRule ^ index.php [QSA,L]
